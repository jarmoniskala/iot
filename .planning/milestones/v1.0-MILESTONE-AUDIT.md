---
milestone: v1.0
audited: 2026-02-20T21:00:00Z
status: tech_debt
scores:
  requirements: 24/24
  phases: 4/4
  integration: 5/5
  flows: 5/5
deferred:
  - id: "HIST-04"
    status: "deferred to v2"
    phase: "Phase 3"
    reason: "Phone-based BLE scanning creates too many short gaps; visualization unreadable until Raspberry Pi gateway (RELY-01). Infrastructure built (SQL + query + component) but rendering intentionally not connected."
    evidence: "REQUIREMENTS.md explicitly marks 'Deferred (v2 — RELY-01 prerequisite)'; detect_gaps SQL, fetchGaps(), GapTooltip component all exist but TrendChart has no gaps prop and no ReferenceArea elements"
gaps:
  requirements: []
  integration: []
  flows: []
tech_debt:
  - phase: 02-live-dashboard
    items:
      - "Dead export: COMFORT_COLORS in lib/constants.ts (never imported; room-card.tsx uses inline COMFORT_BADGE)"
      - "Dead export: cloudCoverLabel in lib/weather.ts (never imported; weather panel shows raw % value)"
      - "Duplicate icon mappings: ROOM_ICONS in lib/constants.ts and ICON_MAP in room-card.tsx (maintenance divergence risk)"
      - "sensor_config Realtime handler only handles UPDATE, not INSERT (new auto-registered sensors show without display_name until page refresh)"
      - "Mobile nav sidebar fixed at 264px width — does not collapse on small screens (data grid IS responsive but nav takes permanent space)"
  - phase: cross-phase
    items:
      - "bigint SQL columns typed as number in TypeScript: movement_counter, row_estimate, reading_count, total_readings (safe at current scale; would lose precision above 2^53)"
      - "Gap threshold hardcoded independently in SQL (> 15) and TypeScript (GAP_THRESHOLD_MINUTES = 15) — values match but not wired together"
      - "REQUIREMENTS.md checkboxes not updated: 23/25 still show [ ] despite all being satisfied"
      - "ROADMAP.md phase checkboxes for Phase 2 and 3 not checked off despite completion"
      - "SUMMARY.md frontmatter missing requirements_completed field for all 7 plans (tracking gap, not code gap)"
  - phase: 01-data-pipeline
    items:
      - "Vault placeholder secrets (YOUR_PROJECT_REF, YOUR_ANON_KEY) require manual update after deployment"
      - "Seed data has placeholder MAC addresses (auto-registration makes this harmless)"
  - phase: 03-history-and-health
    items:
      - "Phase 3 VERIFICATION incorrectly marked HIST-04 as SATISFIED — gap visualization is not wired (no ReferenceArea in TrendChart)"
---

# v1.0 Milestone Audit Report

**Milestone:** v1.0 — Home IoT Monitor
**Audited:** 2026-02-20
**Status:** TECH DEBT (all in-scope requirements satisfied, no critical blockers, accumulated low-severity debt)

---

## Scores

| Category | Score | Details |
|----------|-------|---------|
| Requirements | 24/24 | All in-scope v1 requirements satisfied (HIST-04 deferred to v2) |
| Phases | 4/4 | All phases verified (01=passed, 02=human_needed 14/14, 03=passed, 04=passed) |
| Integration | 5/5 | All E2E flows complete, all cross-phase wiring confirmed |
| Flows | 5/5 | Sensor→Dashboard, FMI→Weather, History, Health, Storage Widget |

---

## Scope Note: HIST-04 Deferral

HIST-04 ("Charts show visual markers where data gaps exist") is explicitly deferred to v2 in REQUIREMENTS.md — phone-based BLE scanning creates too many short gaps, making the visualization unreadable. The infrastructure is fully built (SQL function, query wrapper, client state, GapTooltip component) but the final rendering step (TrendChart receiving gaps) was intentionally not connected. This will be revisited after RELY-01 (Raspberry Pi gateway) provides continuous data.

**Note:** Phase 3 VERIFICATION incorrectly marked HIST-04 as SATISFIED (claimed ReferenceArea and GapTooltip were wired). Actual code inspection confirms no `gaps` prop on TrendChartProps, no ReferenceArea import, and GapTooltip is never imported by any file.

v1 scope: 25 defined - 1 deferred = 24 active requirements.

---

## Phase Verification Summary

| Phase | Status | Score | Gaps | Human Verification Items |
|-------|--------|-------|------|--------------------------|
| 01 — Data Pipeline | passed | 15/15 | 0 | 2 (live Supabase deployment tests) |
| 02 — Live Dashboard | human_needed (14/14 code-verified) | 14/14 | 0 | 5 (Realtime, dark mode, mobile, drag, edit) |
| 03 — History and Health | passed | 15/15 | 0 (HIST-04 VERIFICATION inaccurate) | 7 (chart quality, zoom, gaps, persistence, sort, expand, warnings) |
| 04 — Storage Dashboard Widget | passed | 4/4 | 0 | 1 (live Supabase rendering) |

**Total:** 48/48 observable truths verified. 15 human verification items (all are live-environment confirmations, not code gaps).

---

## Requirements Coverage (3-Source Cross-Reference)

### Source Availability

| Source | Available | Notes |
|--------|-----------|-------|
| VERIFICATION.md | Yes (4/4 phases) | All have detailed requirements tables |
| SUMMARY.md frontmatter | No | `requirements_completed` field absent from all 7 plans |
| REQUIREMENTS.md traceability | Yes | All 25 requirements listed with phase mapping |

### Data Pipeline (Phase 1 + Phase 4)

| REQ-ID | Description | VERIFICATION.md | REQUIREMENTS.md | Final Status |
|--------|-------------|-----------------|-----------------|--------------|
| PIPE-01 | Edge function receives Ruuvi POST and stores readings | SATISFIED (01-VERIFICATION) | `[ ]` Pending | **satisfied** |
| PIPE-02 | Edge function validates (ranges, dedup) | SATISFIED (01-VERIFICATION) | `[ ]` Pending | **satisfied** |
| PIPE-03 | FMI polled via pg_cron every 10 min | SATISFIED (01-VERIFICATION) | `[ ]` Pending | **satisfied** |
| PIPE-04 | FMI XML parsed for Helsinki-Vantaa | SATISFIED (01-VERIFICATION) | `[ ]` Pending | **satisfied** |
| PIPE-05 | Storage usage monitored and displayed | SATISFIED (01-VERIFICATION infra + 04-VERIFICATION UI) | `[x]` Complete | **satisfied** |
| PIPE-06 | Supabase kept alive | SATISFIED (01-VERIFICATION) | `[ ]` Pending | **satisfied** |

### Live Dashboard (Phase 2)

| REQ-ID | Description | VERIFICATION.md | REQUIREMENTS.md | Final Status |
|--------|-------------|-----------------|-----------------|--------------|
| LIVE-01 | Current temp/humidity/pressure per room | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |
| LIVE-02 | Current outdoor weather from FMI | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |
| LIVE-03 | Indoor vs outdoor side-by-side | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |
| LIVE-04 | Last updated timestamps + stale warning | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |
| LIVE-05 | Battery level indicator | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |
| LIVE-06 | Mobile-responsive layout | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |
| LIVE-07 | Dark mode toggle | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |
| COMP-01 | Dew point per room | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |
| COMP-02 | Absolute humidity per room | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |
| COMP-03 | Comfort classification per room | SATISFIED (02-VERIFICATION) | `[ ]` Pending | **satisfied** |

### History and Health (Phase 3)

| REQ-ID | Description | VERIFICATION.md | REQUIREMENTS.md | Final Status |
|--------|-------------|-----------------|-----------------|--------------|
| HIST-01 | Historical trend charts per room | SATISFIED (03-VERIFICATION) | `[ ]` Pending | **satisfied** |
| HIST-02 | Time range presets + custom picker | SATISFIED (03-VERIFICATION) | `[ ]` Pending | **satisfied** |
| HIST-03 | Overlay multiple rooms on same chart | SATISFIED (03-VERIFICATION) | `[ ]` Pending | **satisfied** |
| HIST-04 | Visual markers for data gaps | SATISFIED (03-VERIFICATION — **INACCURATE**) | Deferred (v2) | **deferred** |
| HIST-05 | Summary stats (min, max, avg) | SATISFIED (03-VERIFICATION) | `[ ]` Pending | **satisfied** |
| HLTH-01 | Battery voltage trends per sensor | SATISFIED (03-VERIFICATION) | `[ ]` Pending | **satisfied** |
| HLTH-02 | Signal strength (RSSI) per sensor | SATISFIED (03-VERIFICATION) | `[ ]` Pending | **satisfied** |
| HLTH-03 | Movement counter and last-seen | SATISFIED (03-VERIFICATION) | `[ ]` Pending | **satisfied** |
| HLTH-04 | Measurement sequence gaps | SATISFIED (03-VERIFICATION) | `[ ]` Pending | **satisfied** |

**Orphaned requirements:** None. All 25 v1 requirements appear in at least one phase VERIFICATION.md.

---

## Cross-Phase Integration

### E2E Flows

| # | Flow | Status | Notes |
|---|------|--------|-------|
| 1 | Sensor POST → Dashboard Display | COMPLETE | Ruuvi → ingest-sensors → sensor_readings → Realtime → RoomCard |
| 2 | FMI Poll → Weather Panel | COMPLETE | pg_cron → poll-fmi → weather_observations → Realtime → WeatherPanel |
| 3 | History Charts | COMPLETE | /history → get_sensor_history/detect_gaps/get_summary_stats RPCs → Recharts |
| 4 | Health Warning → Health Page → Trends | COMPLETE | RoomCard warning → /health → get_sensor_health → expandable trend charts |
| 5 | Storage Widget | COMPLETE | get_database_size_mb/get_table_sizes (SECURITY DEFINER) → StorageWidget |

### Migration Ordering

```
001_schema.sql → 002_functions.sql → 003_cron_jobs.sql → 004_realtime_and_views.sql
→ 005_fix_latest_weather_view.sql → 006_history_functions.sql → 007_health_functions.sql
→ 008_storage_security.sql
```

All dependencies satisfied. No circular references. Sequential ordering correct.

### Navigation Connectivity

All 3 routes reachable via Navigation sidebar: `/` (Dashboard), `/history` (History), `/health` (Health). Active state detection works via `usePathname()`.

### Cross-Phase Wiring

- **28 exports** properly consumed across phases
- **3 orphaned exports:** `COMFORT_COLORS` (lib/constants.ts), `cloudCoverLabel` (lib/weather.ts), partial `ROOM_ICONS` duplication
- **0 missing connections** for in-scope requirements

### Integration Nuances (Non-Blocking)

| Finding | Impact |
|---------|--------|
| `sensor_config` Realtime handles UPDATE only, not INSERT | New auto-registered sensor shows without display_name until page refresh |
| `latest_sensor_readings` view has 1-hour recency filter | Sensor disappears from initial load if no reading in past hour; Realtime compensates |
| Mobile nav sidebar (264px fixed) does not collapse | Data grid is responsive; nav takes permanent horizontal space on mobile |
| `bigint` SQL → `number` TypeScript for 4 fields | Safe at current counter/row scales; precision loss above 2^53 |
| Gap threshold hardcoded in SQL (`> 15`) and TS (`GAP_THRESHOLD_MINUTES = 15`) separately | Values match; would diverge if changed independently |

---

## Tech Debt Summary

### Phase 1: Data Pipeline (2 items, INFO)

- Vault placeholder secrets require manual update after deployment
- Seed data placeholder MAC addresses (auto-registration makes harmless)

### Phase 2: Live Dashboard (5 items, LOW)

- Dead export `COMFORT_COLORS` in `lib/constants.ts`
- Dead export `cloudCoverLabel` in `lib/weather.ts`
- Duplicate icon mappings (`ROOM_ICONS` vs `ICON_MAP`)
- `sensor_config` Realtime INSERT not handled
- Mobile nav sidebar does not collapse

### Phase 3: History and Health (1 item, LOW)

- VERIFICATION incorrectly marked HIST-04 as SATISFIED

### Cross-Phase (5 items, LOW/INFO)

- `bigint` → `number` type mismatches (4 SQL columns)
- Gap threshold hardcoded independently in SQL and TypeScript
- REQUIREMENTS.md checkboxes not updated (23/25 still `[ ]`)
- ROADMAP.md phase checkboxes for Phase 2/3 not checked off
- SUMMARY.md frontmatter missing `requirements_completed` for all 7 plans

**Total:** 13 items (8 low, 5 info). No critical or blocking issues.

---

## Conclusion

v1.0 delivers a complete Home IoT Monitor:

- **Data Pipeline**: Ruuvi sensor ingestion + FMI weather polling + auto-partitioning + storage monitoring
- **Live Dashboard**: Real-time room cards with comfort metrics, weather panel, battery/staleness warnings, dark mode, drag-to-reorder
- **Historical Charts**: Time-series trends with zoom/pan, room overlay, summary stats, time range presets
- **System Health**: Sortable sensor table with severity indicators, expandable battery/RSSI trend charts, gap metrics
- **Storage Widget**: Database size progress bar with per-table breakdown

24/24 in-scope requirements implemented and verified. 1 requirement (HIST-04) explicitly deferred to v2. 15 items flagged for human verification in live environment. 13 tech debt items accumulated — none blocking.

---

_Audited: 2026-02-20_
_Auditor: Claude (gsd milestone-audit orchestrator)_
